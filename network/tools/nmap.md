# Nmap

ポートスキャンツール



## switches

```bash
nmap
 -sT # tcp connect scan
 -sS # syn scan
 -sU # udp scan
 -sN # Null scan
 -sF # Fin scan
 -sX # Xmas scan
 -O  # OS Detection
 -sV # Service enumeration
 -v  # verbosity level1
 -vv # verbosity level2
 -oA # save results in three major formats
 -oN # save in a normal format
 -oG # save in grepable format
 -A  # Aggressive mode
 -T5 # timing level5
 -p <port or port range> # specify port
 --script # default script
 --script=vuln # vuln scan
```



Xmas, FIN, NULLスキャンは、ファイアウォールを通る可能性があるので、やってみるといい



## NSE Scripts

- Nmapの機能拡張

- Luaで書かれている

- 以下のカテゴリがある
  - auth
  - broadcast
  - brute
  - discovery
  - dos
  - exploit
  - external
  - fuzzer
  - intrusive
  - malware
  - safe
  - version
  - vuln



`/usr/share/nmap/scripts/`にスクリプトがあるのでそこから実行したいスクリプトを探す。

scriptには引数をとるものもあるので、`--script-args`で渡す

`nmap --script=http-put --script-args http-put.url='/dev/shell.php',http-put.file='./shell.php'`



`nmap --script-help <script-name>`でヘルプのリンクが得られるので適宜活用すべし



## install scripts

```
$ sudo wget -O /usr/share/nmap/scripts/<script-name>.nse https://svn.nmap.org/nmap/scripts/<script-name>.nse
$ nmap --script-updatedb
```



## firewall evasion

- `-Pn`: pingしない
- `-f`: パケットサイズを小さくする
- `--mtu`: mtuを指定する
- `--badsum`: firewallやIDSを通過できる可能性がある